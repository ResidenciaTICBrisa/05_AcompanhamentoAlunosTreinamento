{% extends 'base.html' %}
{% block conteudo %}
{% load static %}
<script>
    function valida_cpf(cpf) {
        var numeros, digitos, soma, i, resultado, digitos_iguais;
        digitos_iguais = 1;
        if (cpf.length < 11)
            return false;
        for (i = 0; i < cpf.length - 1; i++)
            if (cpf.charAt(i) != cpf.charAt(i + 1)) {
                digitos_iguais = 0;
                break;
            }
        if (!digitos_iguais) {
            numeros = cpf.substring(0,9);
            digitos = cpf.substring(9);
            soma = 0;
            for (i = 10; i > 1; i--)
                soma += numeros.charAt(10 - i) * i;
            resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
            if (resultado != digitos.charAt(0))
                return false;
            numeros = cpf.substring(0,10);
            soma = 0;
            for (i = 11; i > 1; i--)
                soma += numeros.charAt(11 - i) * i;
            resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
            if (resultado != digitos.charAt(1))
                return false;
            return true;
        } else
            return false;
    }

    $(document).ready(function() {
        $('#cpf').mask('000.000.000-00', {reverse: true});

        $('#cpf').on('blur', function() {
            var cpfValue = $(this).val().replace(/\D/g, '');
            if (cpfValue && cpfValue.length === 11) {
                if (!valida_cpf(cpfValue)) {
                    alert('O CPF digitado é inválido.');
                    $(this).val('');
                    $(this).focus();
                }
            }
        });
    });
</script>

<content class="content">
    <div class="container">
        <img src="{% static 'imagem/logoFinatec.png' %}" alt="logo" class="logo">
        <h3>Login</h3>
        <form action="{% url 'login' %}" method="POST" class="form">
            {% csrf_token %}
            <div class="inputGroup">
                <div class="input">
                    <label class="name">CPF</label>
                    <input type="text" id="cpf" name="usuario" class="placeholder" placeholder="000.000.000-00" maxlength="14" pattern="\d{3}\.\d{3}\.\d{3}-\d{2}" title="Digite um CPF válido no formato 000.000.000-00." required>
                </div>
                <div class="input">
                    <label class="name">Senha</label>
                    <input type="password" name="senha" class="placeholder" placeholder="••••••">
                </div>
            </div>
            <input type="submit" value="Entrar" class="button-submit">
        </form>
        {% if error_message %}
        <p class="error">{{ error_message }}</p>
        {% endif %}
        <p class="otherLogin">Não possui uma conta? <a href="/cadastro/" class="link">criar</a></p>
    </div>
</content>

{% endblock %}